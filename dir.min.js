#!/usr/bin/env node

function main(){process.argv.length<3&&(console.error("Error: Missing operand"),process.exit(1)),d=process.argv[2],a=P.basename(P.normalize(d)),F.lstatSync(d).isDirectory()||(console.error("Error: Operand isn't a directory"),process.exit(1)),console.log("Reading files ...");var b=F.readdirSync(d);for(var c in b){var e=b[c];if(e!==a+".js"){1!=e.length&&(console.error("Error: %s isn't one character long",e),process.exit(1)),console.log("Reading %s ...",e);var f=F.readFileSync(P.join(d,e),"utf8"),g=f.split("\n"),h=[];g.forEach(function(a){h.push(a.split(""))}),z[e]=h}}console.log("Interpreting ...\n");for(var i=["a",0,0,"init"];null!=i;)i=interpretProgram.apply(interpretProgram,i)}function interpretProgram(a,b,c,d){var e="";if(a===D?e=".":a===N?e="\n":"init"!=d&&(e=a),process.stdout.write(e),u+=e,!(a in z))return console.error("\n\nError: Cannot find %s referenced by %s at (%s, %s)",a,d,b,c),process.exit(1),null;var f=z[a];if(c>f.length-1||b>f[c].length-1)return console.error("\n\nError: %s has no character at (%s, %s) as referenced by %s",a,b,c,d),process.exit(1),null;var g=f[c][b];if(g===L)b--;else if(g===R)b++;else if(g===U)c--;else{if(g!==O)return g===E?(console.log("\n"),writeFile(),process.exit(1),null):(console.error("\n\nError: Expected (%s, %s) in %s to be %s, %s, %s, %s or %s. Found %s",b,c,a,U,R,O,L,E,g),process.exit(1),null);c++}if(c>f.length-1||b>f[c].length-1)return console.error("\n\nError: Arrow at (%s, %s) in %s points to nothing",b,c,a),process.exit(1),null;var h=f[c][b];return h in[E,U,O,L,R]?(console.error("\n\nError: Expected instruction at (%s, %s) in %s, found %s",b,c,a,h),process.exit(1),null):(h===a&&c++,[h,b,c,a])}function writeFile(){var b=P.join(d,a+".js"),c="#!/usr/bin/env node\n\n/* Generated by dir https://github.com/Locercus/dir */\n\n"+u;F.writeFileSync(b,c),F.chmodSync(b,"744"),console.error("Saved as %s",b)}const P=require("path"),F=require("fs");var d,a,z={},u="";const L="\u2190",U="\u2191",R="\u2192",O="\u2193",E="\u2194",N="\u2196",D="\u2197";main(),console.log("");
